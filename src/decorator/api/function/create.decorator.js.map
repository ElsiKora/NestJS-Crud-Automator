{"version":3,"file":"create.decorator.js","sourceRoot":"","sources":["create.decorator.ts"],"names":[],"mappings":"AAKA,OAAO,EAAE,aAAa,EAAE,4BAA4B,EAAE,MAAM,gBAAgB,CAAC;AAE7E,OAAO,EAAE,kBAAkB,EAAE,MAAM,eAAe,CAAC;AACnD,OAAO,EAAE,cAAc,EAAE,MAAM,0CAA0C,CAAC;AAC1E,OAAO,EAAE,WAAW,EAAE,MAAM,uCAAuC,CAAC;AAGpE,MAAM,UAAU,iBAAiB,CAA2B,UAAkC;IAC7F,MAAM,EAAE,MAAM,EAAE,GAA2B,UAAU,CAAC;IAEtD,OAAO,UAAU,MAAe,EAAE,WAAmB,EAAE,UAA8B;QAEpF,KAAK,MAAM,CAAC;QAEZ,KAAK,WAAW,CAAC;QAEjB,UAAU,CAAC,KAAK,GAAG,KAAK,WAIvB,UAA2C;YAE3C,MAAM,UAAU,GAAkB,IAAI,CAAC,UAAU,CAAC;YAElD,IAAI,CAAC,UAAU,EAAE,CAAC;gBACjB,MAAM,cAAc,CAAC,6CAA6C,CAAC,CAAC;YACrE,CAAC;YAED,OAAO,QAAQ,CAAI,EAAE,MAAM,EAAE,UAAU,EAAE,UAAU,EAAE,CAAC,CAAC;QACxD,CAAC,CAAC;QAEF,OAAO,UAAU,CAAC;IACnB,CAAC,CAAC;AACH,CAAC;AAED,KAAK,UAAU,QAAQ,CAA2B,OAAgD;IACjG,MAAM,EAAE,MAAM,EAAE,UAAU,EAAE,UAAU,EAAE,GAA4C,OAAO,CAAC;IAE5F,IAAI,CAAC;QACJ,OAAO,MAAM,UAAU,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC;IAC1C,CAAC;IAAC,OAAO,KAAK,EAAE,CAAC;QAChB,IAAI,KAAK,YAAY,aAAa,EAAE,CAAC;YACpC,MAAM,KAAK,CAAC;QACb,CAAC;QAED,MAAM,IAAI,4BAA4B,CACrC,WAAW,CAAC;YACX,MAAM,EAAE,MAAM;YACd,IAAI,EAAE,kBAAkB,CAAC,cAAc;SACvC,CAAC,CACF,CAAC;IACH,CAAC;AACF,CAAC","sourcesContent":["import type { Repository } from \"typeorm\";\n\nimport type { IApiBaseEntity, IApiFunctionCreateExecutorProperties, IApiFunctionProperties } from \"../../../interface\";\nimport type { TApiFunctionCreateProperties } from \"../../../type\";\n\nimport { HttpException, InternalServerErrorException } from \"@nestjs/common\";\n\nimport { EErrorStringAction } from \"../../../enum\";\nimport { ErrorException } from \"../../../utility/error-exception.utility\";\nimport { ErrorString } from \"../../../utility/error-string.utility\";\n\n// eslint-disable-next-line @elsikora/typescript/no-unnecessary-type-parameters\nexport function ApiFunctionCreate<E extends IApiBaseEntity>(properties: IApiFunctionProperties) {\n\tconst { entity }: IApiFunctionProperties = properties;\n\n\treturn function (target: unknown, propertyKey: string, descriptor: PropertyDescriptor): PropertyDescriptor {\n\t\t// eslint-disable-next-line @elsikora/sonar/void-use\n\t\tvoid target;\n\t\t// eslint-disable-next-line @elsikora/sonar/void-use\n\t\tvoid propertyKey;\n\n\t\tdescriptor.value = async function (\n\t\t\tthis: {\n\t\t\t\trepository: Repository<E>;\n\t\t\t},\n\t\t\tproperties: TApiFunctionCreateProperties<E>,\n\t\t): Promise<IApiBaseEntity> {\n\t\t\tconst repository: Repository<E> = this.repository;\n\n\t\t\tif (!repository) {\n\t\t\t\tthrow ErrorException(\"Repository is not available in this context\");\n\t\t\t}\n\n\t\t\treturn executor<E>({ entity, properties, repository });\n\t\t};\n\n\t\treturn descriptor;\n\t};\n}\n\nasync function executor<E extends IApiBaseEntity>(options: IApiFunctionCreateExecutorProperties<E>): Promise<E> {\n\tconst { entity, properties, repository }: IApiFunctionCreateExecutorProperties<E> = options;\n\n\ttry {\n\t\treturn await repository.save(properties);\n\t} catch (error) {\n\t\tif (error instanceof HttpException) {\n\t\t\tthrow error;\n\t\t}\n\n\t\tthrow new InternalServerErrorException(\n\t\t\tErrorString({\n\t\t\t\tentity: entity,\n\t\t\t\ttype: EErrorStringAction.CREATING_ERROR,\n\t\t\t}),\n\t\t);\n\t}\n}\n"]}