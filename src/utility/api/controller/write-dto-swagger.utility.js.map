{"version":3,"file":"write-dto-swagger.utility.js","sourceRoot":"","sources":["write-dto-swagger.utility.ts"],"names":[],"mappings":"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","sourcesContent":["import type { Type } from \"@nestjs/common\";\n\nimport type { EApiRouteType } from \"../../../enum\";\nimport type { IApiControllerProperties, IApiEntity } from \"../../../interface\";\nimport type { TApiControllerPropertiesRoute, TMetadata } from \"../../../type\";\n\nimport { DECORATORS } from \"@nestjs/swagger/dist/constants\";\n\nimport { MetadataStorage } from \"../../../class\";\nimport { PROPERTY_DESCRIBE_DECORATOR_API_CONSTANT } from \"../../../constant\";\nimport { EApiDtoType, EApiPropertyDescribeType } from \"../../../enum\";\nimport { CamelCaseString } from \"../../camel-case-string.utility\";\nimport { DtoGenerate } from \"../../dto\";\n\nexport function ApiControllerWriteDtoSwagger<E>(target: object, entity: IApiEntity<E>, properties: IApiControllerProperties<E>, method: EApiRouteType, routeConfig: TApiControllerPropertiesRoute<E, typeof method>, entityMetadata: IApiEntity<E>): void {\n\tconst swaggerModels: Array<unknown> = (Reflect.getMetadata(DECORATORS.API_EXTRA_MODELS, target) ?? []) as Array<unknown>;\n\n\tconst requestDto: Type<unknown> | undefined = routeConfig.dto?.request ?? DtoGenerate(properties.entity, entity, method, EApiDtoType.REQUEST, routeConfig.autoDto?.[EApiDtoType.REQUEST], routeConfig.authentication?.guard);\n\tconst queryDto: Type<unknown> | undefined = routeConfig.dto?.query ?? DtoGenerate(properties.entity, entity, method, EApiDtoType.QUERY, routeConfig.autoDto?.[EApiDtoType.QUERY], routeConfig.authentication?.guard);\n\tconst bodyDto: Type<unknown> | undefined = routeConfig.dto?.body ?? DtoGenerate(properties.entity, entity, method, EApiDtoType.BODY, routeConfig.autoDto?.[EApiDtoType.BODY], routeConfig.authentication?.guard);\n\tconst responseDto: Type<unknown> | undefined = routeConfig.dto?.response ?? DtoGenerate(properties.entity, entity, method, EApiDtoType.RESPONSE, routeConfig.autoDto?.[EApiDtoType.RESPONSE], routeConfig.authentication?.guard);\n\n\tconst dtoList: Array<Type<unknown> | undefined> = [requestDto, queryDto, bodyDto, responseDto];\n\n\tfor (const dto of dtoList) {\n\t\tif (dto && !swaggerModels.includes(dto)) {\n\t\t\tswaggerModels.push(dto);\n\n\t\t\tconst storage: MetadataStorage = MetadataStorage.getInstance();\n\n\t\t\tconst metadata: TMetadata | undefined = storage.getMetadata(entityMetadata.name ?? \"UnknownResource\");\n\n\t\t\tif (metadata)\n\t\t\t\tfor (const key of Object.keys(metadata)) {\n\t\t\t\t\tif (metadata[key]?.[PROPERTY_DESCRIBE_DECORATOR_API_CONSTANT.METADATA_PROPERTY_NAME] && metadata[key]?.[PROPERTY_DESCRIBE_DECORATOR_API_CONSTANT.METADATA_PROPERTY_NAME].type === EApiPropertyDescribeType.RELATION) {\n\t\t\t\t\t\tconst relationClass: { new (): any; prototype: any } = class GeneratedDTO {\n\t\t\t\t\t\t\tconstructor() {\n\t\t\t\t\t\t\t\tObject.defineProperty(this, \"id\", {\n\t\t\t\t\t\t\t\t\t// eslint-disable-next-line @elsikora/typescript/naming-convention\n\t\t\t\t\t\t\t\t\tconfigurable: true,\n\t\t\t\t\t\t\t\t\t// eslint-disable-next-line @elsikora/typescript/naming-convention\n\t\t\t\t\t\t\t\t\tenumerable: true,\n\t\t\t\t\t\t\t\t\tvalue: undefined,\n\t\t\t\t\t\t\t\t\t// eslint-disable-next-line @elsikora/typescript/naming-convention\n\t\t\t\t\t\t\t\t\twritable: true,\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t};\n\n\t\t\t\t\t\tObject.defineProperty(relationClass, \"name\", {\n\t\t\t\t\t\t\tvalue: `${String(entityMetadata.name)}${CamelCaseString(method)}${CamelCaseString(EApiDtoType.BODY)}${key}DTO`,\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\tswaggerModels.push(relationClass);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\tReflect.defineMetadata(DECORATORS.API_EXTRA_MODELS, swaggerModels, target);\n\t\t}\n\t}\n}\n"]}