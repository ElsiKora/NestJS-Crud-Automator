{"version":3,"file":"generate.utility.js","sourceRoot":"","sources":["generate.utility.ts"],"names":[],"mappings":"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","sourcesContent":["import type { Type } from \"@nestjs/common\";\nimport type { IAuthGuard } from \"@nestjs/passport\";\nimport type { ObjectLiteral } from \"typeorm\";\n\nimport type { IApiControllerPropertiesRouteAutoDtoConfig, IApiEntity } from \"../../interface\";\nimport type { TApiPropertyDescribeProperties } from \"../../type\";\n\nimport { Validate } from \"class-validator\";\n\nimport { PROPERTY_DESCRIBE_DECORATOR_API_CONSTANT } from \"../../constant\";\nimport { DTO_GENERATE_CONSTANT } from \"../../constant/utility/dto/generate.constant\";\nimport { EApiDtoType, EApiRouteType } from \"../../enum\";\nimport { HasPairedCustomSuffixesFields } from \"../../validator/has-paired-custom-suffixes-fields.validator\";\nimport { CamelCaseString } from \"../camel-case-string.utility\";\nimport { ErrorException } from \"../error-exception.utility\";\n\nimport { DtoBuildDecorator } from \"./build-decorator.utility\";\nimport { DtoGenerateFilterDecorator } from \"./generate-filter-decorator.utility\";\nimport { DtoGenerateGetListResponse } from \"./generate-get-list-response.utility\";\nimport { DtoGetGetListQueryBaseClass } from \"./get-get-list-query-base-class.utility\";\nimport { DtoIsPropertyShouldBeMarked } from \"./is-property-should-be-marked.utility\";\nimport { DtoIsShouldBeGenerated } from \"./is-should-be-generated.utility\";\n\nexport function DtoGenerate<E>(entity: ObjectLiteral, entityMetadata: IApiEntity<E>, method: EApiRouteType, dtoType: EApiDtoType, dtoConfig?: IApiControllerPropertiesRouteAutoDtoConfig, currentGuard?: Type<IAuthGuard>): Type<unknown> | undefined {\n\tif (!DtoIsShouldBeGenerated(method, dtoType)) {\n\t\treturn undefined;\n\t}\n\n\tif (!entityMetadata.primaryKey?.metadata?.[PROPERTY_DESCRIBE_DECORATOR_API_CONSTANT.METADATA_PROPERTY_NAME]) {\n\t\tthrow ErrorException(`Primary key for entity ${String(entityMetadata.name)} not found in metadata storage`);\n\t}\n\n\tconst markedProperties: Array<{\n\t\tisPrimary: boolean;\n\t\tmetadata: TApiPropertyDescribeProperties;\n\t\tname: keyof E;\n\t}> = [];\n\n\tfor (const column of entityMetadata.columns) {\n\t\tif (column.metadata?.[PROPERTY_DESCRIBE_DECORATOR_API_CONSTANT.METADATA_PROPERTY_NAME] && DtoIsPropertyShouldBeMarked(method, dtoType, column.name as string, column.metadata[PROPERTY_DESCRIBE_DECORATOR_API_CONSTANT.METADATA_PROPERTY_NAME] as TApiPropertyDescribeProperties, column.isPrimary, currentGuard)) {\n\t\t\tmarkedProperties.push({\n\t\t\t\tisPrimary: column.isPrimary,\n\t\t\t\tmetadata: column.metadata[PROPERTY_DESCRIBE_DECORATOR_API_CONSTANT.METADATA_PROPERTY_NAME] as TApiPropertyDescribeProperties,\n\t\t\t\tname: column.name,\n\t\t\t});\n\t\t}\n\t}\n\tconst BaseClass: Type = method === EApiRouteType.GET_LIST && dtoType === EApiDtoType.QUERY ? DtoGetGetListQueryBaseClass<E>(entity, entityMetadata, method, dtoType) : class {};\n\n\tclass GeneratedDTO extends BaseClass {\n\t\tconstructor() {\n\t\t\tsuper();\n\n\t\t\tfor (const property of markedProperties) {\n\t\t\t\tif (method === EApiRouteType.GET_LIST && dtoType === EApiDtoType.QUERY) {\n\t\t\t\t\tObject.defineProperty(this, `${property.name as string}[value]`, {\n\t\t\t\t\t\t// eslint-disable-next-line @elsikora/typescript/naming-convention\n\t\t\t\t\t\tconfigurable: true,\n\t\t\t\t\t\t// eslint-disable-next-line @elsikora/typescript/naming-convention\n\t\t\t\t\t\tenumerable: true,\n\t\t\t\t\t\tvalue: undefined,\n\t\t\t\t\t\t// eslint-disable-next-line @elsikora/typescript/naming-convention\n\t\t\t\t\t\twritable: true,\n\t\t\t\t\t});\n\n\t\t\t\t\tObject.defineProperty(this, `${property.name as string}[values]`, {\n\t\t\t\t\t\t// eslint-disable-next-line @elsikora/typescript/naming-convention\n\t\t\t\t\t\tconfigurable: true,\n\t\t\t\t\t\t// eslint-disable-next-line @elsikora/typescript/naming-convention\n\t\t\t\t\t\tenumerable: true,\n\t\t\t\t\t\tvalue: undefined,\n\t\t\t\t\t\t// eslint-disable-next-line @elsikora/typescript/naming-convention\n\t\t\t\t\t\twritable: true,\n\t\t\t\t\t});\n\n\t\t\t\t\tObject.defineProperty(this, `${property.name as string}[operator]`, {\n\t\t\t\t\t\t// eslint-disable-next-line @elsikora/typescript/naming-convention\n\t\t\t\t\t\tconfigurable: true,\n\t\t\t\t\t\t// eslint-disable-next-line @elsikora/typescript/naming-convention\n\t\t\t\t\t\tenumerable: true,\n\t\t\t\t\t\tvalue: undefined,\n\t\t\t\t\t\t// eslint-disable-next-line @elsikora/typescript/naming-convention\n\t\t\t\t\t\twritable: true,\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\tObject.defineProperty(this, property.name, {\n\t\t\t\t\t\t// eslint-disable-next-line @elsikora/typescript/naming-convention\n\t\t\t\t\t\tconfigurable: true,\n\t\t\t\t\t\t// eslint-disable-next-line @elsikora/typescript/naming-convention\n\t\t\t\t\t\tenumerable: true,\n\t\t\t\t\t\tvalue: undefined,\n\t\t\t\t\t\t// eslint-disable-next-line @elsikora/typescript/naming-convention\n\t\t\t\t\t\twritable: true,\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tfor (const property of markedProperties) {\n\t\tconst decorators: Array<PropertyDecorator> | undefined = DtoBuildDecorator(method, property.metadata, entityMetadata, dtoType, property.name as string, currentGuard);\n\n\t\tif (decorators) {\n\t\t\tfor (const [, decorator] of decorators.entries()) {\n\t\t\t\tif (method === EApiRouteType.GET_LIST && dtoType === EApiDtoType.QUERY) {\n\t\t\t\t\tdecorator(GeneratedDTO.prototype, `${property.name as string}[value]`);\n\n\t\t\t\t\tDtoGenerateFilterDecorator(property.metadata, entityMetadata)(GeneratedDTO.prototype, `${property.name as string}[operator]`);\n\t\t\t\t} else {\n\t\t\t\t\tdecorator(GeneratedDTO.prototype, property.name as string);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (method === EApiRouteType.GET_LIST && dtoType === EApiDtoType.QUERY) {\n\t\t\t// @ts-ignore\n\t\t\tconst metadataArray: TApiPropertyDescribeProperties = { ...property.metadata, isArray: true, isUniqueItems: false, maxItems: DTO_GENERATE_CONSTANT.MAXIMUM_FILTER_PROPERTIES, minItems: DTO_GENERATE_CONSTANT.MINIMUM_FILTER_PROPERTIES };\n\n\t\t\tconst decoratorsArray: Array<PropertyDecorator> | undefined = DtoBuildDecorator(method, metadataArray, entityMetadata, dtoType, property.name as string, currentGuard);\n\n\t\t\tif (decoratorsArray) {\n\t\t\t\tfor (const [, decorator] of decoratorsArray.entries()) {\n\t\t\t\t\tdecorator(GeneratedDTO.prototype, `${property.name as string}[values]`);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tif (dtoConfig?.validators) {\n\t\tfor (const validator of dtoConfig.validators) {\n\t\t\tValidate(validator.constraintClass as unknown as () => any, validator.options)(GeneratedDTO.prototype, \"object\");\n\t\t}\n\t}\n\n\tif (method === EApiRouteType.GET_LIST && dtoType === EApiDtoType.QUERY) {\n\t\tObject.defineProperty(GeneratedDTO.prototype, \"object\", {\n\t\t\t// eslint-disable-next-line @elsikora/typescript/naming-convention\n\t\t\tconfigurable: true,\n\t\t\t// eslint-disable-next-line @elsikora/typescript/naming-convention\n\t\t\tenumerable: true,\n\t\t\tvalue: function (this: InstanceType<typeof GeneratedDTO>): InstanceType<typeof GeneratedDTO> {\n\t\t\t\treturn this;\n\t\t\t},\n\t\t\t// eslint-disable-next-line @elsikora/typescript/naming-convention\n\t\t\twritable: true,\n\t\t});\n\n\t\tValidate(HasPairedCustomSuffixesFields, [\"operator\", [\"value\", \"values\"]])(GeneratedDTO.prototype, \"object\");\n\t}\n\n\tObject.defineProperty(GeneratedDTO, \"name\", {\n\t\tvalue: `${entityMetadata.name ?? \"UnknownResource\"}${CamelCaseString(method)}${CamelCaseString(dtoType)}ItemsDTO`,\n\t});\n\n\t// @ts-ignore\n\treturn method === EApiRouteType.GET_LIST && dtoType === EApiDtoType.RESPONSE ? DtoGenerateGetListResponse(entity, GeneratedDTO, `${entityMetadata.name ?? \"UnknownResource\"}${CamelCaseString(method)}${CamelCaseString(dtoType)}DTO`) : GeneratedDTO;\n}\n"]}