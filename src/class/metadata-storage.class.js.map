{"version":3,"file":"metadata-storage.class.js","sourceRoot":"","sources":["metadata-storage.class.ts"],"names":[],"mappings":"AAIA,OAAO,EAAE,wCAAwC,EAAE,MAAM,aAAa,CAAC;AAEvE,MAAM,OAAO,eAAe;IACnB,MAAM,CAAC,QAAQ,CAAkB;IAExB,OAAO,GAA6C,IAAI,GAAG,EAAuC,CAAC;IAE7G,MAAM,CAAC,WAAW;QACxB,IAAI,CAAC,eAAe,CAAC,QAAQ,EAAE,CAAC;YAC/B,eAAe,CAAC,QAAQ,GAAG,IAAI,eAAe,EAAE,CAAC;QAClD,CAAC;QAED,OAAO,eAAe,CAAC,QAAQ,CAAC;IACjC,CAAC;IAEM,sBAAsB;QAC5B,MAAM,MAAM,GAA8B,EAAE,CAAC;QAE7C,KAAK,MAAM,CAAC,UAAU,EAAE,cAAc,CAAC,IAAI,IAAI,CAAC,OAAO,CAAC,OAAO,EAAE,EAAE,CAAC;YACnE,MAAM,CAAC,UAAU,CAAC,GAAG,MAAM,CAAC,WAAW,CAAC,cAAc,CAAC,CAAC;QACzD,CAAC;QAED,OAAO,MAAM,CAAC;IACf,CAAC;IAKM,WAAW,CAAC,UAAkB,EAAE,YAAqB,EAAE,GAA0B;QACvF,MAAM,cAAc,GAA4C,IAAI,CAAC,OAAO,CAAC,GAAG,CAAC,UAAU,CAAC,CAAC;QAE7F,IAAI,CAAC,cAAc;YAAE,OAAO,SAAS,CAAC;QAEtC,IAAI,CAAC,YAAY;YAAE,OAAO,MAAM,CAAC,WAAW,CAAC,cAAc,CAAC,CAAC;QAC7D,MAAM,gBAAgB,GAA+B,cAAc,CAAC,GAAG,CAAC,YAAY,CAAC,CAAC;QAEtF,IAAI,CAAC,gBAAgB;YAAE,OAAO,SAAS,CAAC;QAExC,IAAI,CAAC,GAAG;YAAE,OAAO,gBAAgB,CAAC;QAElC,OAAO,gBAAgB,CAAC,GAAG,CAAC,CAAC;IAC9B,CAAC;IAEM,WAAW,CAAiC,UAAkB,EAAE,YAAoB,EAAE,GAAM,EAAE,KAAwB;QAC5H,IAAI,CAAC,IAAI,CAAC,OAAO,CAAC,GAAG,CAAC,UAAU,CAAC,EAAE,CAAC;YACnC,IAAI,CAAC,OAAO,CAAC,GAAG,CAAC,UAAU,EAAE,IAAI,GAAG,EAAE,CAAC,CAAC;QACzC,CAAC;QAED,MAAM,cAAc,GAAgC,IAAI,CAAC,OAAO,CAAC,GAAG,CAAC,UAAU,CAAE,CAAC;QAElF,IAAI,CAAC,cAAc,CAAC,GAAG,CAAC,YAAY,CAAC,EAAE,CAAC;YACvC,cAAc,CAAC,GAAG,CAAC,YAAY,EAAE,EAAE,CAAC,wCAAwC,CAAC,sBAAsB,CAAC,EAAE,EAAE,EAAE,CAAC,CAAC;QAC7G,CAAC;QAGD,MAAM,gBAAgB,GAAmB,cAAc,CAAC,GAAG,CAAC,YAAY,CAAE,CAAC;QAC3E,gBAAgB,CAAC,GAAG,CAAC,GAAG,KAAK,CAAC;IAC/B,CAAC;CACD","sourcesContent":["/* eslint-disable @elsikora/javascript/no-dupe-class-members */\nimport type { IMetadataEntry } from \"../interface\";\nimport type { TMetadata } from \"../type\";\n\nimport { PROPERTY_DESCRIBE_DECORATOR_API_CONSTANT } from \"../constant\";\n\nexport class MetadataStorage {\n\tprivate static instance: MetadataStorage;\n\n\tprivate readonly STORAGE: Map<string, Map<string, IMetadataEntry>> = new Map<string, Map<string, IMetadataEntry>>();\n\n\tpublic static getInstance(): MetadataStorage {\n\t\tif (!MetadataStorage.instance) {\n\t\t\tMetadataStorage.instance = new MetadataStorage();\n\t\t}\n\n\t\treturn MetadataStorage.instance;\n\t}\n\n\tpublic getAllEntitiesMetadata(): Record<string, TMetadata> {\n\t\tconst result: Record<string, TMetadata> = {};\n\n\t\tfor (const [entityName, entityMetadata] of this.STORAGE.entries()) {\n\t\t\tresult[entityName] = Object.fromEntries(entityMetadata);\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tpublic getMetadata(entityName: string): TMetadata | undefined;\n\tpublic getMetadata(entityName: string, propertyName: string): IMetadataEntry | undefined;\n\tpublic getMetadata<K extends keyof IMetadataEntry>(entityName: string, propertyName: string, key: K): IMetadataEntry[K] | undefined;\n\tpublic getMetadata(entityName: string, propertyName?: string, key?: keyof IMetadataEntry): IMetadataEntry | IMetadataEntry[keyof IMetadataEntry] | TMetadata | undefined {\n\t\tconst entityMetadata: Map<string, IMetadataEntry> | undefined = this.STORAGE.get(entityName);\n\n\t\tif (!entityMetadata) return undefined;\n\n\t\tif (!propertyName) return Object.fromEntries(entityMetadata);\n\t\tconst propertyMetadata: IMetadataEntry | undefined = entityMetadata.get(propertyName);\n\n\t\tif (!propertyMetadata) return undefined;\n\n\t\tif (!key) return propertyMetadata;\n\n\t\treturn propertyMetadata[key];\n\t}\n\n\tpublic setMetadata<K extends keyof IMetadataEntry>(entityName: string, propertyName: string, key: K, value: IMetadataEntry[K]): void {\n\t\tif (!this.STORAGE.has(entityName)) {\n\t\t\tthis.STORAGE.set(entityName, new Map());\n\t\t}\n\t\t// eslint-disable-next-line @elsikora/typescript/no-non-null-assertion\n\t\tconst entityMetadata: Map<string, IMetadataEntry> = this.STORAGE.get(entityName)!;\n\n\t\tif (!entityMetadata.has(propertyName)) {\n\t\t\tentityMetadata.set(propertyName, { [PROPERTY_DESCRIBE_DECORATOR_API_CONSTANT.METADATA_PROPERTY_NAME]: {} });\n\t\t}\n\n\t\t// eslint-disable-next-line @elsikora/typescript/no-non-null-assertion\n\t\tconst propertyMetadata: IMetadataEntry = entityMetadata.get(propertyName)!;\n\t\tpropertyMetadata[key] = value;\n\t}\n}\n"]}