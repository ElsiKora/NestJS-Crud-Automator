# Decorators

Complete reference for all decorators provided by NestJS CRUD Automator.

## Controller Decorators

### @ApiController

Automatically generates CRUD endpoints for an entity.

```typescript
@ApiController<E>(options: IApiControllerProperties<E>)
```

**Parameters:**

- `options.entity` - Entity class
- `options.name` - API resource name (for Swagger)
- `options.path` - Custom route path (optional)
- `options.routes` - Route configurations

**Example:**

```typescript
@Controller("users")
@ApiController<UserEntity>({
	entity: UserEntity,
	name: "Users",
	routes: {
		[EApiRouteType.CREATE]: {},
		[EApiRouteType.GET]: {},
		[EApiRouteType.GET_LIST]: {},
		[EApiRouteType.UPDATE]: {},
		[EApiRouteType.DELETE]: {},
	},
})
export class UserController {}
```

**Related:**

- [Core Concepts - Controllers](/docs/nestjs-crud-automator/core-concepts/controllers)

### @ApiControllerObservable

Marks a controller as observable, enabling route-level subscribers.

```typescript
@ApiControllerObservable()
```

**Example:**

```typescript
@Controller("posts")
@ApiController({
	/* ... */
})
@ApiControllerObservable()
export class PostController {}
```

**Related:**

- [Subscriber System - Route Subscribers](/docs/nestjs-crud-automator/subscriber-system/route-subscribers)

### @ApiControllerSecurable

Marks a controller as securable, enabling the automatic authorization guard generated by `@ApiController`.

```typescript
@Controller("users")
@ApiControllerSecurable()
@ApiController<UserEntity>({ /* ... */ })
export class UserController {}
```

If the decorator is omitted, the guard short-circuits and no authorization policies are evaluated for that controller.

**Related:**

- [Authorization Guide](/docs/nestjs-crud-automator/guides/authorization)

## Service Decorators

### @ApiService

Automatically adds CRUD methods to a service class.

```typescript
@ApiService<E>(properties: TApiServiceProperties<E>)
```

**Parameters:**

- `properties.entity` - Entity class

**Example:**

```typescript
@Injectable()
@ApiService<UserEntity>({
	entity: UserEntity,
})
export class UserService extends ApiServiceBase<UserEntity> {
	constructor(
		@InjectRepository(UserEntity)
		public repository: Repository<UserEntity>,
	) {
		super();
	}
}
```

**Related:**

- [Core Concepts - Services](/docs/nestjs-crud-automator/core-concepts/services)

### @ApiServiceObservable

Marks a service as observable, enabling function-level subscribers.

```typescript
@ApiServiceObservable()
```

**Example:**

```typescript
@Injectable()
@ApiService({
	/* ... */
})
@ApiServiceObservable()
export class PostService extends ApiServiceBase<PostEntity> {}
```

**Related:**

- [Subscriber System - Function Subscribers](/docs/nestjs-crud-automator/subscriber-system/function-subscribers)

## Property Decorators

All property-level decorators accept the `entity` option as either a direct class reference or a factory `() => Entity`. The factory form is useful when DTOs and entities live in different modules that would otherwise create circular imports. If the factory cannot resolve the entity immediately, the decorator re-attempts resolution on the next microtask so the metadata still uses the correct entity name once the module finishes loading.

### @ApiPropertyDescribe

Provides metadata for entity properties used in DTO generation, validation, and Swagger documentation.

```typescript
@ApiPropertyDescribe(properties: TApiPropertyDescribeProperties)
```

**Common Properties:**

- `type` - Property type (UUID, STRING, NUMBER, BOOLEAN, DATE, ENUM, OBJECT, RELATION)
- `description` - Property description
- `isRequired` - Whether field is required
- `exampleValue` - Example value for Swagger

**Type-Specific Properties:**

#### UUID Properties

```typescript
{
  type: EApiPropertyDescribeType.UUID,
  description: "Unique identifier",
}
```

#### String Properties

```typescript
{
  type: EApiPropertyDescribeType.STRING,
  description: "Field description",
  format: EApiPropertyStringType.STRING, // STRING, EMAIL, URL, PASSWORD
  minLength: 3,
  maxLength: 50,
  pattern: "/^[a-zA-Z0-9]+$/",
  exampleValue: "example",
}
```

#### Number Properties

```typescript
{
  type: EApiPropertyDescribeType.NUMBER,
  description: "Numeric field",
  format: EApiPropertyNumberType.INTEGER, // INTEGER, FLOAT
  minimum: 0,
  maximum: 100,
  exampleValue: 42,
}
```

#### Boolean Properties

```typescript
{
  type: EApiPropertyDescribeType.BOOLEAN,
  description: "Boolean field",
  defaultValue: false,
  exampleValue: true,
}
```

#### Date Properties

```typescript
{
  type: EApiPropertyDescribeType.DATE,
  identifier: EApiPropertyDateIdentifier.CREATED_AT, // CREATED_AT, UPDATED_AT, DELETED_AT
  format: EApiPropertyDateType.DATE_TIME, // DATE, DATE_TIME, TIME
}
```

#### Enum Properties

```typescript
{
  type: EApiPropertyDescribeType.ENUM,
  description: "Enum field",
  enum: UserRole,
  enumName: "UserRole",
  defaultValue: UserRole.USER,
  exampleValue: UserRole.ADMIN,
}
```

#### Object Properties

```typescript
{
  type: EApiPropertyDescribeType.OBJECT,
  description: "Object field",
  properties: {
    key1: { type: "string" },
    key2: { type: "number" },
  },
  exampleValue: { key1: "value", key2: 123 },
}
```

#### Relation Properties

```typescript
{
  type: EApiPropertyDescribeType.RELATION,
  description: "Related entity",
  relationMetadata: {
    relationType: "many-to-one",
    entity: RelatedEntity,
    isEager: false,
  },
}
```

**DTO Control:**

```typescript
{
  type: EApiPropertyDescribeType.STRING,
  description: "Field",
  dto: {
    body: {
      isExposedInCreateDto: true,
      isExposedInUpdateDto: true,
      isRequiredInCreateDto: true,
      isRequiredInUpdateDto: false,
    },
    response: {
      isExposed: true,
    },
    query: {
      getList: {
        isExposedAsFilter: true,
      },
    },
    guard: {
      responseGuards: [AdminGuard],
    },
  },
}
```

**Related:**

- [Core Concepts - Entities](/docs/nestjs-crud-automator/core-concepts/entities)

### @ApiPropertyCopy

Copies all generated decorators (validation, Swagger, transformers) from an entity property to a DTO property.

```typescript
ApiPropertyCopy<E>(
  entityOrFactory: Type<E> | (() => Type<E> | undefined),
  propertyName: keyof E,
  method: EApiRouteType,
  dtoType: EApiDtoType,
  metadata?: Partial<TApiPropertyDescribeProperties>,
  guard?: Type<IAuthGuard>
)
```

**Usage:**

```typescript
class DepositResponseDto {
  @ApiPropertyCopy(DepositEntity, "amount", EApiRouteType.GET, EApiDtoType.RESPONSE)
  amount!: number;
}
```

When circular imports delay entity initialization (for example, when DTOs live in another module), wrap the entity reference in a factory so it can be resolved later:

```typescript
class DepositCallbackRequestBodyDto {
  @ApiPropertyCopy(() => DepositEntity, "status", EApiRouteType.GET, EApiDtoType.RESPONSE)
  status!: EDepositStatus;
}
```

If the factory still returns `undefined`, the decorator throws a descriptive error explaining how to provide the entity lazily.

## Subscriber Decorators

### @ApiRouteSubscriber

Creates a route-level subscriber that intercepts controller operations.

```typescript
@ApiRouteSubscriber(options: IApiRouteSubscriberProperties<E>)
```

**Parameters:**

- `options.entity` - Entity class
- `options.priority` - Execution priority (higher executes first)

**Example:**

```typescript
@Injectable()
@ApiRouteSubscriber({
	entity: PostEntity,
	priority: 10,
})
export class PostAuditSubscriber extends ApiRouteSubscriberBase<PostEntity> {
	async onAfterCreate(context: IApiSubscriberRouteExecutionContext<PostEntity, PostEntity>): Promise<PostEntity> {
		console.log("Post created:", context.result);
		return context.result;
	}
}
```

**Related:**

- [Subscriber System - Route Subscribers](/docs/nestjs-crud-automator/subscriber-system/route-subscribers)

### @ApiFunctionSubscriber

Creates a function-level subscriber that intercepts service operations.

```typescript
@ApiFunctionSubscriber(options: IApiFunctionSubscriberProperties<E>)
```

**Parameters:**

- `options.entity` - Entity class
- `options.priority` - Execution priority (higher executes first)

**Example:**

```typescript
@Injectable()
@ApiFunctionSubscriber({
	entity: PostEntity,
})
export class PostSlugSubscriber extends ApiFunctionSubscriberBase<PostEntity> {
	async onBeforeCreate(context: IApiSubscriberFunctionExecutionContext<PostEntity, any>): Promise<any> {
		context.result.body.slug = this.generateSlug(context.result.body.title);
		return context.result;
	}
}
```

**Related:**

- [Subscriber System - Function Subscribers](/docs/nestjs-crud-automator/subscriber-system/function-subscribers)

## Authorization Decorators

### @ApiAuthorizationPolicy

Registers an authorization policy for an entity. Policies are discovered automatically by `ApiAuthorizationModule` and executed before every generated route.

```typescript
@ApiAuthorizationPolicy<E>({
  entity: UserEntity,
  priority?: number;
  policyId?: string;
  description?: string;
})
```

**Example:**

```typescript filename="policies/user-access.policy.ts" copy
import { ApiAuthorizationPolicy, ApiAuthorizationPolicyBase } from "@elsikora/nestjs-crud-automator";
import { UserEntity } from "../user.entity";

@ApiAuthorizationPolicy<UserEntity>({ entity: UserEntity, priority: 150 })
export class UserAccessPolicy extends ApiAuthorizationPolicyBase<UserEntity> {
	onBeforeGet() {
		return this.allowForRoles(["admin", "support"]);
	}
}
```

**Related:**

- [Authorization Guide](/docs/nestjs-crud-automator/guides/authorization)
- [ApiAuthorizationPolicyBase](#apiauthorizationpolicybase)

## Next Steps

- [Classes](/docs/nestjs-crud-automator/api-reference/classes) - Base classes reference
- [Interfaces](/docs/nestjs-crud-automator/api-reference/interfaces) - Type definitions
- [Enums](/docs/nestjs-crud-automator/api-reference/enums) - Enumeration values
